package Abstraction;

import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;

public abstract class MagicSite {
	public WebDriver driver;
	protected WebDriverWait wait;
	protected String downloadFilepath;
	
	public void navigateToMagicSite() {
		String urlPart1 = driver.getCurrentUrl().substring(0, 15);
		String urlPart2 = driver.getCurrentUrl().substring(15, driver.getCurrentUrl().length());
		String url = urlPart1 + "magic" + urlPart2;
		driver.navigate().to(url);
	}
	
	public void downloadVid(String fileType) throws InterruptedException {
		String window = driver.getWindowHandle();
		driver.findElement(By.xpath("//button[text() = 'Load Options']")).click();
		
		List<WebElement> links = driver.findElements(By.xpath("//a[contains(text(),'0p')]"));
		if (fileType.contains("true")) {
			driver.findElement(By.xpath("//a[text() = 'Listen ']")).click();
		} 
		else if (links.contains("720p")) {
			System.out.println("finding 720p link");
			driver.findElement(By.linkText("700p")).click();
		}
		else {
			System.out.println("finding 360p link");
			driver.findElement(By.linkText("360")).click();
		}

		driver.findElement(By.xpath("//a[text() = ' > Click here to continue < ']")).click();
		
		driver.switchTo().window(window);
		driver.findElement(By.xpath("//a[text() = 'Click here to start ']")).click();
		
		wait.until(ExpectedConditions.visibilityOf(driver.findElement(By.xpath("//div[@style = 'min-width: 20px; width: 100%;']"))));
		String filename = driver.getTitle().substring(16);
		Thread.sleep(5000);
		System.out.println(filename + " was successfully downloaded");
	}
}
